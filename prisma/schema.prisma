generator client {
  provider = "prisma-client-js"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  userId         Int      @id @default(autoincrement())
  firstName      String
  lastName       String
  email          String   @unique
  passwordHash   String
  phone          String?
  role           String
  dateRegistered DateTime @default(now())

  reservations     Reservation[]
  reviews          Review[]
  ownedRestaurants Restaurant[]
}

model Restaurant {
  restaurantId Int       @id @default(autoincrement())
  name         String
  description  String?
  phone        String?
  email        String?
  priceRange   String?
  openingTime  DateTime?
  closingTime  DateTime?
  status       String?

  ownerId  Int?
  owner    User?    @relation(fields: [ownerId], references: [userId])
  branches Branch[]
}

model Branch {
  branchId Int @id @default(autoincrement())

  city String
  area String

  restaurantId Int
  restaurant   Restaurant @relation(fields: [restaurantId], references: [restaurantId])

  tables   Table[]
  reviews  Review[]
  cuisines BranchCuisine[]
}

model Table {
  tableId     Int @id @default(autoincrement())
  capacity    Int
  tableNumber Int

  branchId     Int
  branch       Branch        @relation(fields: [branchId], references: [branchId])
  reservations Reservation[]
}

model Reservation {
  reservationId       Int      @id @default(autoincrement())
  reservationDateTime DateTime
  numberOfPeople      Int
  status              String

  userId  Int
  tableId Int

  user  User  @relation(fields: [userId], references: [userId])
  table Table @relation(fields: [tableId], references: [tableId])
}

model Cuisine {
  cuisineId   Int     @id @default(autoincrement())
  name        String
  description String?

  menuItems MenuItem[]
  branches  BranchCuisine[]
}

model MenuItem {
  menuItemId     Int     @id @default(autoincrement())
  name           String
  description    String?
  numberOfPeople Int?

  cuisineId Int
  cuisine   Cuisine @relation(fields: [cuisineId], references: [cuisineId])
}

model Review {
  reviewId Int      @id @default(autoincrement())
  rating   Int
  comment  String?
  date     DateTime @default(now())

  userId   Int
  branchId Int

  user   User   @relation(fields: [userId], references: [userId])
  branch Branch @relation(fields: [branchId], references: [branchId])
}

model BranchCuisine {
  branchId  Int
  cuisineId Int

  branch  Branch  @relation(fields: [branchId], references: [branchId])
  cuisine Cuisine @relation(fields: [cuisineId], references: [cuisineId])

  @@id([branchId, cuisineId])
}
